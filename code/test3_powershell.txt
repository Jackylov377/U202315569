# 基本参数
$endpoint = "http://127.0.0.1:9000"
$accessKey = "admin"
$accessSecret = "admin123"
$bucket = "test"
$numSamples = 5000   # 每次实验请求数
$numClientsList = @(1, 5, 10, 20)  # 并发数列表
$objectSizes = @(1024, 10240, 102400, 1048576, 10485760)  # 对象大小列表，1KB~10MB
$repeat = 3  # 每个组合重复实验次数

# 创建结果目录
$resultDir = "s3bench_results_highdata"
if (-not (Test-Path $resultDir)) {
    New-Item -ItemType Directory -Path $resultDir | Out-Null
}

# 循环执行测试
foreach ($size in $objectSizes) {
    foreach ($clients in $numClientsList) {
        for ($r = 1; $r -le $repeat; $r++) {
            Write-Host "Running s3bench with size=$size bytes, clients=$clients, run #$r..."
            $resultFile = "$resultDir\result_size_${size}_clients_${clients}_run${r}.txt"
            
            s3bench -endpoint $endpoint `
                    -accessKey $accessKey `
                    -accessSecret $accessSecret `
                    -bucket $bucket `
                    -numClients $clients `
                    -numSamples $numSamples `
                    -objectSize $size `
                    -verbose `
                    > $resultFile
            
            Write-Host "Result saved to $resultFile"
        }
    }
}

Write-Host " All tests completed. Results are in $resultDir folder."
